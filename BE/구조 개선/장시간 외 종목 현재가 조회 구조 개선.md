
### 전체적인 아키텍처
![](refImg/Pasted%20image%2020260214141404.png)

### 문제 원인
- Redis 캐시 저장소에 종목 현재가 및 신선도 데이터가 존재하고 시간과 관계없이 캐시 데이터의 신선도가 5초가 넘었다면 비동기 이벤트를 발행.
- 비동기 이벤트를 발행하면 외부 API와 통신하여 최신 현재가를 조회하고 캐시 데이터에 저장.
- 장시간 외에서 종목 현재가를 요청했을때 시간과 관계없이 비동기 이벤트를 발행하고, 외부 API와 통신하여 불필요한 조회를 수행.
### 해결 과정
- 기존 존재하는 캐시 데이터에 접근할때 신선도와 장시간을 확인하도록 구현.
- 신선도가 떨어지고 장시간 중이라면 비동기 이벤트를 발행하여 최신 현재가를 조회 및 저장.
- 신선도가 떨어지지만 장시간 외라면 현재가는 변하지 않으므로 별도의 비동기 이벤트를 발행시키지 않음.
- 테스트
	- 로컬 환경에서 장시간이 끝난 시간에 100명의 사용자가 랜덤한 50개의 종목을 대상으로 10분동안 지속적으로 종목 검색 API 수행
	- 캐시 저장소에 저장된 종목 데이터들은 신선도가 떨어지고 최신 현재가를 저장되어 있음.
	- Ramp-up=50초 설정하여 1초에 2명씩 접속하여 성능 테스트 수행
### 결과
- 성능 테스트 결과, 기존 시스템과 개선된 시스템의 평균 응답 시간 20~25ms, 처리량(Throughtput) 약 19ms/sec으로써 비슷하다는 것을 확인.
- 반면 메트릭 데이터중 스레드풀이 완료한 비동기 작업의 개수가 기존 시스템은 4400개인 반면, 개선된 시스템은 11개로 측정.
- 불필요한 비동기 작업을 감소시켜서 CPU 및 네트워크 I/O를 약 99% 개선.

