
## 현재 방식
종목의 현재가와 관련된 API 호출시 컨트롤러 레이어에서 활성 종목을 등록하는 비동기 이벤트를 발행합니다.
```java
// 포트폴리오 목록 조회  
@GetMapping  
public ApiResponse<PortfoliosResponse> searchMyAllPortfolios(  
    @MemberAuthenticationPrincipal MemberAuthentication authentication) {  
    // 활성 종목 등록  
    Set<String> tickers = portFolioService.getAllPortfolioTickers(authentication.getId());  
    eventPublisher.publishEvent(new StocksViewedEvent(tickers));  
  
    return ApiResponse.success(PortfolioSuccessCode.OK_SEARCH_PORTFOLIOS,  
       portFolioService.readMyAllPortfolio(authentication.getId()));  
}
```


## 현재 방식의 문제점
현재 위와 같은 활성 종목을 등록하는 코드들이 9개 정도 존재하고, 비슷하게 중복되어 있습니다. 각각의 API별로 조금씩은 다르지만 핵심은 API와 관련된 종목의 티커 심볼을 조회한 다음에 이벤트를 발행하는 것은 동일합니다. 현재 방식의 문제점을 정리하면 다음과 같습니다.
- 비즈니스 로직의 중복
	- 추후 요구사항 변경으로 인하여 로깅이나, 이벤트 발행 조건이 변경도면 9곳 모두 일일히 수정해야 합니다.
- 컨트롤러의 책임 과중
	- 컨트롤러의 주 역할은 요청을 받고 응답을 반환하는 것이지만 현재 코드는 티커 리스트를 조회하고, 이벤트 생성 및 발행하고 있습니다. 이로 인해서 컨트롤러가 비즈니스 흐름을 너무 상세하게 제어하게 되어 코드가 비대해지고 가독성이 떨어지게 됩니다.

## 개선안
AOP를 적용하여 활성 종목을 등록하는 코드를 인프라 로직으로 분리하여 개선합니다. 

9개의 API 호출시 전달해야 하는 매개변수 정리
- 포트폴리오 목록: 회원 식별자
- 포트폴리오 종목 조회 : 포트폴리오 식별자
- 포트폴리오 차트 조회 : 포트폴리오 식별자
- 종목 상세 정보 : 종목의 티커 심볼
- 종목 지정가 목록 조회 : 종목의 티커 심볼
- 종목 지정가 특정 조회 : 종목의 티커 심볼
- Watchlist 조회 : 관심 종목 리스트 식별자
- 오버뷰 : 회원 식별자
- 포트폴리오 파이 차트