
### heap dump 파일은 무엇인가?
- 힙 메모리는 임의로 생성한 객체들이 동적으로 할당되는 공간을 의미하는데, **힙 덤프 파일은 운영중인 애플리케이션의 힙 메모리 영역을 스냅샷으로 기록한 내역을 저장한 파일을 의미**합니다.

### heap dump 파일 생성 시기
- 모든 경우에 대해서 스냅샷을 생성할 필요는 없고, 런타임 시점에 OOM(Out of Memory)이 발생하는 경우에 스냅샷을 생성하고 파일 내용을 분석하면 됩니다.

### OOM은 어떤 경우에 발생하는가?
#### OutOfMemoryError: Java Heap Space
- 힙 영역에 공간이 부족한 경우에 발생합니다. 가장 많이 확인되는 케이스일 것입니다.
- 힙 영역에 대한 공간 확보는 GC를 통해서 이루어지는데, GC를 수행하기 이전에 힙 메모리 영역이 부족할 경우에 발생합니다.

```java
public class JavaHeapSpace {
  public static void main(String[] args) throws Exception {
    String[] array = new String[100000 * 100000];
  }
}
```

#### OutOfMemoryError: GC Overhead limit exceeded
- GC를 진행하는데 CPU 98% 이상 사용되고, GC 이후에 2% 미만으로 복구 되었을 경우입니다.
- 무분별하게 객체를 생성하는 경우에 발생합니다. 문제점을 해결하고, 경우에 따라서 메모리 사이즈를 늘리는 것을 추천합니다.
```java
public class GCOverhead {
  public static void main(String[] args) throws Exception {
    Map<Long, Long> map = new HashMap<>();
    for (long i = 0l; i < Long.MAX_VALUE; i++) {
      map.put(i, i);
    }
  }
}
```

#### OutOfMemoryError: Requested array size exceeds VM limit
- 힙 영역보다 더 큰 영역의 배열을 할당할 경우 발생합니다.
- 배열 사이즈를 조정하거나 메모리 사이즈를 증가시켜서 해결할 수 있습니다.
```java
public class GCOverhead {
  public static void main(String[] args) throws Exception {
    for (int i = 0; i < 10; i++) {
      int[] arr = new int[Integer.MAX_VALUE - 1];
    }
  }
}
```

#### OutOfMemoryError: Metaspace
- Metaspace 영역이 부족한 경우에 발생합니다.
- 클래스의 메타데이터(클래스 이름, 생성 정보, 필드 정보, 메서드 정보 등)가 저장되는 공간으로 JDK 7 이전에는 PermGen으로 정의되었습니다.