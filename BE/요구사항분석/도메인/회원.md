
- [[#닉네임 중복 검사|닉네임 중복 검사]]
- [[#이메일 중복 검사|이메일 중복 검사]]
- [[#검증 코드 전송|검증 코드 전송]]
- [[#검증 코드 검사|검증 코드 검사]]
- [[#일반 회원가입|일반 회원가입]]
- [[#회원|회원]]
- [[#인증|인증]]
- [[#알림|알림]]


## 닉네임 중복 검사
### 기능 개요
- 사용자는 닉네임을 입력하여 해당 닉네임이 다른 회원과 중복되는지 확인할 수 있습니다.
- 모든 회원의 닉네임은 고유해야 하며, 중복된 닉네임은 사용할 수 없습니다.
- 닉네임 중복검사 기능은 **회원가입 시** 또는 **프로필 정보 변경 시** 수행됩니다.

### 입력 규칙
- 닉네임은 **한글, 영문 대소문자, 숫자**로만 구성되어야 합니다.
- 닉네임의 길이는 **2자 이상 100자 이하**여야 합니다.
- **공백 및 특수문자는 허용되지 않습니다.**
- **대소문자는 구분되지 않습니다.**
- 닉네임 형식은 다음 정규식을 만족해야 합니다.
```regex
^[가-힣a-zA-Z0-9]{2,100}$
```

### 제약조건
- 데이터베이스의 `nickname` 컬럼에는 **UNIQUE 제약조건**을 설정합니다.

---

## 이메일 중복 검사
### 기능 개요
- 사용자는 이메일을 입력하여 로컬 회원들의 이메일 중에서 중복되는 이메일이 존재하는지 확인 할 수 있습니다.
- 소셜 인증 플랫폼으로 가입한 회원을 제외한 로컬 회원들들 중에서 이메일은 고유해야 합니다.

### 입력 규칙
- 공백은 허용하지 않습니다.
- 이메일은 대소문자를 구분되지 않습니다.
- 이메일 형식은 다음 정규식을 만족해야 합니다.
```
^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$
```

### 제약 조건
- `provider` 컬럼과 `email` 컬럼의 **조합(combination)**이 **고유(unique)**해야 합니다.

---

## 검증 코드 전송
### 기능 개요
- 사용자는 이메일을 입력하면 회원가입을 위한 검증 코드를 전송 받을 수 있습니다.
- 시스템은 이메일을 입력받으면 이메일로 검증 코드를 전송합니다.

### 입력 규칙
- 검증 코드는 6자리 숫자로 구성되어야 합니다.
- 예를 들어 000000 ~ 999999 사이의 수로 구성됩니다.
- 

### 수행 과정
1. 사용자는 이메일을 입력하고 검증 코드 전송을 요청합니다.
2. 시스템은 랜덤한 검증 코드를 생성한 다음에 저장소에 저장한 다음에 사용자가 제출한 이메일로 검증 코드를 전송합니다.
3. 사용자는 이메일로 검증 코드를 수신받습니다.

### 제약 조건
- 저장소에 저장되는 검증 코드는 5분간 일시적으로 저장해야 한다.

---

## 검증 코드 검사
### 기능 개요
- 사용자는 메일로 수신받은 검증 코드를 시스템에 제출하여 검사를 요청합니다.
- 시스템은 사용자로부터 받은 검증 코드와 시스템이 가지고 있는 검증 코드가 일치하는지 검사합니다.

### 입력 규칙
- [검증 코드 입력 규칙](#검증%20코드%20전송#입력%20규칙)

---


## 일반 회원가입
### 기능 개요
- 사용자는 회원가입 정보를 입력하여 회원가입을 수행합니다.
- 시스템은 사용자로부터 회원가입 정보를 입력받고 회원 정보를 생성하고 저장합니다.
- 클라이언트는 프로필 사진을 전달하기 위해서 다음과 같이 수행합니다.
	- 클라이언트는 기본 프로필 사진으로 설정하기 위해서는 profileImageFile 프로퍼티를 포함하지 않습니다.
	- 클라이언트는 새로운 프로필 사진으로 설정하기 위해서는 profileImageFile 프로퍼티에 새로운 프로필 사진을 업로드하여 전송합니다.

### 입력 규칙
- [닉네임 입력 규칙](#닉네임%20중복%20검사#입력%20규칙)
- [이메일 입력 규칙](#이메일%20중복%20검사#입력%20규칙)
- 비밀번호 입력 규칙
	- 길이: 8자 이상 16자 이하
	- 영문자(대/소문자) 최소 1개 포함
	- 숫자 최소 1개 포함
	- 특수문자(!@#$%^&*) 최소 1개 포함
	- 공백, 이모지, 허용되지 않은 문자는 포함 불가
	- `^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[!@#$%^&*])[a-zA-Z\\d!@#$%^&*]{8,16}$`

### 수행과정
1. 사용자는 닉네임, 이메일, 비밀번호, 비밀번호 확인, 프로필 사진(선택)을 입력하여 일반 회원가입을 요청합니다.
2. 시스템은 사용자로부터 입력 정보를 받으면 회원을 생성해도 되는지 검증합니다.
3. 검증에 성공하면 시스템은 회원 데이터를 생성하여 추가합니다.

### 제약 조건
- 사용자의 닉네임은 고유해야 합니다.
- 이메일은 일반 회원들간에는 고유해야 합니다.
	- 예를 들어 Naver 플랫폼을 통하여 가입한 사용자의 이메일이 `user1@naver.com` 인 상태에서 다른 사용자가 일반 회원가입으로 `user1@naver.com`로 요청시 회원 가입 될 수 있습니다.
- 프로필 사진의 최대 크기는 10MB 이하여야 합니다.

---

## 프로필 조회
### 기능 개요
- 사용자는 회원 프로필 정보를 요청합니다.
- 시스템은 사용자의 프로필 정보를 조회하여 응답합니다.

### 수행과정
1. 사용자는 서버에 현재 로그인한 회원의 프로필 정보 조회를 요청합니다.
2. 서버는 회원의 식별자를 가지고 회원의 프로필 정보를 조회 및 응답합니다.

### 제약 조건
- 사용자는 인증(로그인) 상태여야 합니다.
- 사용자는 다른 사용자의 프로필 정보를 조회할 수 없습니다.

---

## 회원 프로필 수정
### 기능 개요
- 사용자는 **회원 정보**(닉네임, 프로필 사진)을 수정할 수 있습니다.
- 클라이언트는 **form-data 형식**으로 프로필 파일(profileImageFile)과 프로필 정보(profileInformation)를 전달합니다.
	- `profileImageFile`과 `profileInformation`은 선택적으로 포함될 수 있습니다.
	- `profileInformation`에는 `nickname`이 포함됩니다.
- 클라이언트가 프로필 파일을 전송하는 경우들은 다음과 같습니다.
	- [[#프로필 수정시 기본 프로필 파일로 변경]]
	- [[#프로필 수정시 새로운 프로필 파일로 변경]]
	- [[#프로필 수정시 기존 프로필 사진으로 유지]]


### 기능적 요구사항
입력 형식

| 항목                          | 필수 여부 | 설명                                |
| --------------------------- | ----- | --------------------------------- |
| profileImageFile            | 선택    | 업로드할 새 프로필 이미지 파일(또는 비어있거나 생략 가능) |
| profileInformation          | 선택    | 회원 프로필 관련 정보 객체                   |
| profileInformation.nickname | 선택    | 수정할 닉네임                           |

처리 흐름
1. 사용자가 프로필 수정 화면에서 닉네임과 프로필 사진을 변경 후 수정을 요청합니다.
2. 서버는 요청 데이터를 검증합니다.
3. 수정 가능한 경우, 프로필 정보를 변경합니다.
4. 서버는 수정 결과를 클라이언트에 응답합니다.

동작 시나리오
(1) 기본 프로필 파일로 변경

| 구분    | 내용                                                                                          |
| ----- | ------------------------------------------------------------------------------------------- |
| 입력 조건 | `profileImageFile`이 빈 파일로 전송됨                                                               |
| 처리 로직 | - 기존 `profileUrl` 이 null 값이 아니라면 저장소에서 기존 이미지 파일을 삭제함<br>- 회원의 `profileUrl` 값을 null 값으로 저장함 |
| 결과    | 기본 이미지 프로필 사진으로 변경됨                                                                         |

(2) 새로운 프로필 파일로 변경

| 구분    | 내용                                                                                 |
| ----- | ---------------------------------------------------------------------------------- |
| 입력 조건 | `profileImageFile`에 새로운 이미지 파일이 포함됨                                                |
| 처리 로직 | - 기존 저장소에 프로필 이미지 파일이 삭제됨<br>- 새로운 이미지 파일을 저장소에 업로드<br>- `profileUrl`을 새 URL로 업데이트 |
| 결과    | 새로운 프로필 이미지 사진으로 변경됨                                                               |

(3) 기존 프로필 사진 유지

| 구분    | 내용                                                       |
| ----- | -------------------------------------------------------- |
| 입력 조건 | 요청에 `profileImageFile` 프로퍼티가 존재하지 않음                     |
| 처리 로직 | - 서버는 `profileImageFile`프로퍼티가 존재하지 않기 때문에 아무 작업도 수행하지 않음 |
| 결과    | 기존 프로필 이미지 사진 유지                                         |

### 비기능적 요구사항

| 항목       | 설명                                      |
| -------- | --------------------------------------- |
| 파일 크기 제한 | 업로드 가능한 프로필 이미지 사진의 크기는 최대 10MB 이하여야 함 |
| 데이터 유효성  | 회원의 닉네임은 중복될 수 없음 (단, 본인 닉네임은 예외)       |
| 저장소      | 프로필 이미지는 외부 저장소에 저장 및 삭제되어야 함           |
| 응답 형식    | 서버는 수정 결과를 JSON 형식으로 응답한다               |
| 보안       | 수정 요청은 인증된 본인만 수행할 수 있음                 |

### 예외 처리


### 제약 조건
- 프로필 사진의 최대 크기는 10MB 이하여야 합니다.
- 회원의 닉네임이 중복되면 안됩니다. (회원 본인 것을 제외한 닉네임에서 중복 검사)


---

### 비밀번호 변경
- 일반 회원 사용자는 자신의 비밀번호를 변경할 수 있습니다.
- 사용자는 현재 비밀번호, 새로운 비밀번호, 새로운 비밀번호 확인을 전달하며 비밀번호를 변경해야 합니다.
- 입력 형식
	- 영문자, 숫자, 특수문자를 각각 최소 하나 이상 포함하는 문자열이어야 합니다.

### 계정 삭제
- 사용자는 자신의 계정을 삭제할 수 있습니다.
- 사용자는 선택적으로 refreshToken을 전달합니다.

---

## 인증
### 일반 로그인
- 사용자는 이메일과 비밀번호를 입력하여 일반 로그인을 할 수 있습니다.
- 서버는 로그인 후 쿠키에 액세스 토큰 및 리프레시 토큰을 넣어서 응답

### 소셜 로그인
- 사용자는 구글, 카카오, 네이버중 한곳을 선택하여 소셜 로그인을 할 수 있습니다.
- 만약 사용자가 첫 소셜 로그인을 하는 경우라면 회원가입 처리되어야 합니다.

### 로그아웃
- 사용자는 로그아웃을 요청할 수 있습니다.
- 쿠키로 액세스 토큰, 리프레시 토큰을 전달받아서 로그아웃 처리합니다.
- 서버는 액세스 토큰, 리프레시 토큰을 받으면 블랙 리스트에 추가하여야 합니다.

### 액세스 토큰 갱신
- 사용자는 인가가 요구되는 API 요청시 쿠키에 액세스 토큰 및 리프레시 토큰을 담아서 전송한다. 만약 액세스 토큰이 만료되고, 리프레시 토큰이 만료되지 않았다면 액세스 토큰을 갱신한다. 갱신한후 서버는 쿠키에 액세스 토큰, 리프레시 토큰을 담아서 응답한다
- 리프레시 토큰의 만료시간이 1시간 미만인 경우 리프레시 토큰 또한 갱신하여야 한다
- 사용자가 API 요청시 액세스 토큰, 리프레시 토큰 둘다 만료되었다면 401 응답합니다.
- 해당 서비스는 별도의 액세스 토큰 갱신 API를 명시하여 처리하는 것이 아닌 다른 인가가 요구되는 API 수행중에 처리하여야 합니다.

## 알림

### 회원 알림 목록 조회
- 사용자는 웹 애플리케이션을 실행하면서 그동안 온 알림들을 조회합니다.
- **알림 조회시 읽지 않은 알림들과 읽었지만 삭제하지 않은 알림들을 조회**합니다.
- 정렬 기준 : 최근에 온 알림 메시지가 제일 앞에 위치해야 함

### 회원 알림 모두 읽음
- 사용자는 알림 메시지들을 모두 읽을 수 있습니다.
- 클라이언트는 알람 모두 읽음 처리를 위해서 서버로 알림의 등록번호 리스트를 전달하며 읽음 처리를 요청합니다.
- 서버는 알림 등록번호 리스트를 받아서 해당하는 알림들을 읽음 처리합니다.

### 회원 특정 알림 읽음
- 사용자는 특정한 알림을 읽을 수 있습니다.
- 클라이언트는 알림 읽음 처리를 위해서 서버로 알림의 등록번호를 전달하며 읽음 처리를 요청합니다.
- 서버는 알림 등록번호를 받아서 해당하는 알림을 읽음 처리합니다.

### 회원 알림 단일 삭제
- 사용자는 특정한 알림을 선택하고 지우기를 할 수 있습니다.

### 회원 알림 전체 삭제
- 사용자는 알림 메시지들을 모두 지울 수 있습니다.

### 회원 알림 설정 수정
사용자는 클라이언트 애플리케이션의 데스크탑 설정 및 사용자 알림 설정을 수정할 수 있습니다.
- 브라우저로부터 데스크탑 알림 받기는 사용자가 애플리케이션으로부터 브라우저 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : false
- 포트폴리오 목표 수익률 도달 알림 설정은 사용자가 애플리케이션으로부터 각각의 포트폴리오에 설정된 목표 수익률 도달 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : true
	- 해당 옵션이 false이면 각 포트폴리오의 목표 수익률 도달 알림이 true여도 알림을 받지 않습니다. 즉, 전체 포트폴리오의 목표 수익률 도달 알림을 받지 않겠다는 것을 의미합니다.
- 포트폴리오 최대 손실율 도달 알림 설정은 사용자가 애플리케이션으로부터 각각의 포트폴리오에 설정된 최대 손실율 도달 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : true
	- 해당 옵션도 false이면 목표 수익율 도달 알림 설정과 동일합니다.
- 종목 지정가 알림 설정은 사용자가 애플리케이션으로부터 특정한 종목이 특정한 가격에 도달했음을 알려주는 설정입니다.
	- 기본값 : true
	- 해당 옵션이 false이면 특정한 종목 지정가 알림이 활성화되어 있어도 전부 알림을 받지 않습니다.
- 해당 알림 설정이 false로 변경되어도 각 포트폴리오 및 지정가에 설정된 상세 알림 설정은 변경되지 않는다. 예를 들어 포트폴리오의 목표 수익률 도달 알림 설정이 false로 변경되어도 각 특정한 포트폴리오에 설정된 목표 수익율 도달 알림은 false로 변경되지 않는다.
![[Pasted image 20240131153924.png]]
- 알림 설정에서 4가지 설정(브라우저, 포트폴리오 목표 수익률, 최대 손실율, 종목 지정가 알림)이 전부 비활성화로 변경한 다음에 저장을 한다면 서버의 FCM 토큰은 제거되어야 합니다.
	- 별도의 fcmTokenId가 전송됩니다.