- [[#회원가입|회원가입]]
	- [[#회원가입#이메일 중복 검사|이메일 중복 검사]]
	- [[#회원가입#이메일 검증 코드|이메일 검증 코드]]
	- [[#회원가입#인증 코드 검사|인증 코드 검사]]
	- [[#회원가입#일반 회원가입|일반 회원가입]]
- [[#회원|회원]]
	- [[#회원#회원 생성|회원 생성]]
	- [[#회원#회원 목록 조회|회원 목록 조회]]
	- [[#회원#회원 상세 조회|회원 상세 조회]]
	- [[#회원#회원 정보 수정|회원 정보 수정]]
	- [[#회원#회원 삭제|회원 삭제]]
	- [[#회원#프로필 조회|프로필 조회]]
	- [[#회원#프로필 수정|프로필 수정]]
		- [[#프로필 수정#프로필 수정시 기본 프로필 파일로 변경|프로필 수정시 기본 프로필 파일로 변경]]
		- [[#프로필 수정#프로필 수정시 새로운 프로필 파일로 변경|프로필 수정시 새로운 프로필 파일로 변경]]
		- [[#프로필 수정#프로필 수정시 기존 프로필 사진으로 유지|프로필 수정시 기존 프로필 사진으로 유지]]
	- [[#회원#비밀번호 변경|비밀번호 변경]]
	- [[#회원#계정 삭제|계정 삭제]]
- [[#인증|인증]]
	- [[#인증#일반 로그인|일반 로그인]]
	- [[#인증#소셜 로그인|소셜 로그인]]
	- [[#인증#로그아웃|로그아웃]]
	- [[#인증#액세스 토큰 갱신|액세스 토큰 갱신]]
- [[#알림|알림]]
	- [[#알림#회원 알림 목록 조회|회원 알림 목록 조회]]
	- [[#알림#회원 알림 모두 읽음|회원 알림 모두 읽음]]
	- [[#알림#회원 특정 알림 읽음|회원 특정 알림 읽음]]
	- [[#알림#회원 알림 단일 삭제|회원 알림 단일 삭제]]
	- [[#알림#회원 알림 전체 삭제|회원 알림 전체 삭제]]
	- [[#알림#회원 알림 설정 수정|회원 알림 설정 수정]]


## 회원가입
### 닉네임(nickname) 중복검사
#### 기능 개요
- 사용자는 닉네임을 입력하여 해당 닉네임이 다른 회원과 중복되는지 확인할 수 있습니다.
- 모든 회원의 닉네임은 고유해야 하며, 중복된 닉네임은 사용할 수 없습니다.
- 닉네임 중복검사 기능은 **회원가입 시** 또는 **프로필 정보 변경 시** 수행됩니다.

#### 입력 규칙
- 닉네임은 **한글, 영문 대소문자, 숫자**로만 구성되어야 합니다.
- 닉네임의 길이는 **2자 이상 100자 이하**여야 합니다.
- **공백 및 특수문자는 허용되지 않습니다.**
- **대소문자는 구분되지 않습니다.**
- 닉네임 형식은 다음 정규식을 만족해야 합니다.
```regex
^[가-힣a-zA-Z0-9]{2,100}$
```

#### 제약조건
- 데이터베이스의 `nickname` 컬럼에는 **UNIQUE 제약조건**을 설정합니다.

### 이메일 중복 검사
- 사용자는 이메일을 입력하여 이메일이 중복되는지 확인할 수 있습니다.
- 조건
	- 일반 회원의 이메일 중에서 이메일이 고유해야 합니다.
- 입력 형식
	- 일반적인 이메일 형식이어야 합니다.
	- ex) user1@gmail.com

### 이메일 검증 코드
- 사용자는 이메일을 입력하여 검증 코드를 받을 수 있습니다.

### 인증 코드 검사
- 사용자는 이메일을 통해서 받은 인증 코드를 입력하여 인증 코드 검사를 받을 수 있습니다.
- 입력 형식
	- 인증 코드의 입력 형식은 숫자 6자리입니다.
	- ex) 000303

### 일반 회원가입
- 사용자는 닉네임, 이메일, 비밀번호, 프로필 사진을 입력하여 일반 회원가입 할 수 있습니다.
- 닉네임은 고유해야합니다.
- 이메일은 로컬 회원상에서는 고유해야 합니다.
- 프로필 사진의 최대 크기는 10MB 이하여야 합니다.
- 클라이언트는 프로필 사진을 전달하기 위해서 다음과 같이 수행합니다.
	- 클라이언트는 기본 프로필 사진으로 설정하기 위해서는 profileImageFile 프로퍼티를 포함하지 않습니다.
	- 클라이언트는 새로운 프로필 사진으로 설정하기 위해서는 profileImageFile 프로퍼티에 새로운 프로필 사진을 업로드하여 전송합니다.

---

## 회원
### 회원 생성
- 관리자는 사용자의 정보를 입력하여 회원을 생성할 수 있습니다.
	- 입력 정보
		- 닉네임, 이메일, 프로필 사진, 비밀번호, 역할
	- 프로필 사진은 선택적 정보입니다.
	- 역할은 사용자(ROLE_USER), 매니저(ROLE_MANAGER), 관리자(ROLE_ADMIN) 중 하나여야 합니다.
- 생성되는 회원들은 로컬 회원으로써 생성되어야 합니다.
- 관리자는 회원 생성시 1개 이상의 역할(USER, MANAGER, ADMIN)을 설정하여야 합니다.
- 관리자가 회원을 생성하는 경우에는 별도의 이메일과 같은 인증 절차를 가지지 않습니다.
- 해당 기능은 관리 기능이어야 합니다.

### 회원 목록 조회
- 관리자는 회원들을 조회할 수 있습니다.
- 회원 정보 조회시 비밀번호와 같은 민감 정보를 조회해서는 안된다
- 관리자는 특정 키워드(닉네임, 이메일, 식별번호 등) 를 포함하여 회원들을 조회할 수 있습니다.
- 회원 목록들은 페이지 단위로 응답되어야 합니다.
	- 1 페이지에 최대 10개의 회원들을 볼 수 있습니다.
	- 페이지의 그룹은 5개 단위입니다.
- 해당 기능은 관리 기능이어야 합니다.

### 회원 상세 조회
- 관리자는 특정 회원의 정보를 상세 조회할 수 있습니다.
- 회원 상세 조회시 비밀번호와 같은 정보를 조회해서는 안된다
- 해당 기능은 관리 기능이어야 합니다.

### 회원 정보 수정
- 관리자는 회원의 정보를 수정할 수 있습니다.
- 해당 기능은 관리 기능이어야 합니다.

### 회원 삭제
- 관리자는 회원을 삭제할 수 있습니다.
- 해당 기능은 관리 기능이어야 합니다.

### 프로필 조회
- 사용자는 로그인한 상태에서 자신의 프로필 정보를 조회할 수 있습니다.

### 프로필 수정
- 사용자는 회원 정보인 닉네임과 프로필 사진을 변경할 수 있습니다.
- 클라이언트는 form-data 형식으로 프로필 파일과 닉네임을 전달하여 프로필 수정을 요청합니다.
	- 클라이언트는 profileImageFile과 profileInformation을 포함하거나 포함하지 않을 수 있습니다.
	- profileInformation에는 nickname이 존재합니다.
- 클라이언트가 프로필 파일을 전송하는 경우들은 다음과 같습니다.
	- [[#프로필 수정시 기본 프로필 파일로 변경]]
	- [[#프로필 수정시 새로운 프로필 파일로 변경]]
	- [[#프로필 수정시 기존 프로필 사진으로 유지]]
- 프로필 수정시 프로필 사진의 최대 크기는 10MB 이하여야 합니다.
- 프로필 수정시 닉네임이 중복되면 안됩니다. (회원 본인 것을 제외한 닉네임에서 중복 검사)

#### 프로필 수정시 기본 프로필 파일로 변경
- 서버는 클라이언트로부터 다음과 같이 전송받습니다.
	- profileImageFile : 빈 파일
- 서버는 기본 프로필 파일로 변경하기 위해서 다음과 같이 수행합니다.
	- 회원의 profileUrl 값을 이용하여 null이 아니라면 s3에 저장된 프로필 사진을 삭제합니다.
	- 회원의 profileUrl 값을 null로 저장합니다.

#### 프로필 수정시 새로운 프로필 파일로 변경
- 서버는 클라이언트로부터 다음과 같이 전송받습니다.
	- profileImageFile : 새로운 프로필 파일
- 서버는 새로운 프로필 파일로 변경하기 위해서 다음과 같이 수행합니다.
	- 회원의 profileUrl 값을 이용해서 s3에 저장된 이미지 파일을 삭제한다
	- profileImageFile로 전달받은 이미지 파일로 s3에 새로운 프로필 사진을 등록합니다.
	- 회원의 profileUrl 값을 s3에 새로 업로드한 프로필 사진의 URL을 저장합니다.

#### 프로필 수정시 기존 프로필 사진으로 유지
- 서버는 클라이언트로부터 다음과 같이 전송받습니다.
	- profileImageFile : 프로퍼티 자체를 포함하지 않음
- 서버는 기존 프로필 사진으로 유지하기 위해서 다음과 같이 수행합니다.
	- 서버는 profileImageFile이 empty하기 때문에 별도의 수행을 하지 않는다.

프로필 수정시 3가지 경우를 표로 정리하면 다음과 같습니다. 표에서

| property         | 기본 프로필 사진 변경 | 새로운 프로필 사진 변경 | 기존 프로필 사진 유지 |
| ---------------- | ------------ | ------------- | ------------ |
| profileImageFile | empty File   | File          | 프로퍼티 포함 x    |

### 비밀번호 변경
- 일반 회원 사용자는 자신의 비밀번호를 변경할 수 있습니다.
- 사용자는 현재 비밀번호, 새로운 비밀번호, 새로운 비밀번호 확인을 전달하며 비밀번호를 변경해야 합니다.
- 입력 형식
	- 영문자, 숫자, 특수문자를 각각 최소 하나 이상 포함하는 문자열이어야 합니다.

### 계정 삭제
- 사용자는 자신의 계정을 삭제할 수 있습니다.
- 사용자는 선택적으로 refreshToken을 전달합니다.

---

## 인증
### 일반 로그인
- 사용자는 이메일과 비밀번호를 입력하여 일반 로그인을 할 수 있습니다.
- 서버는 로그인 후 쿠키에 액세스 토큰 및 리프레시 토큰을 넣어서 응답

### 소셜 로그인
- 사용자는 구글, 카카오, 네이버중 한곳을 선택하여 소셜 로그인을 할 수 있습니다.
- 만약 사용자가 첫 소셜 로그인을 하는 경우라면 회원가입 처리되어야 합니다.

### 로그아웃
- 사용자는 로그아웃을 요청할 수 있습니다.
- 쿠키로 액세스 토큰, 리프레시 토큰을 전달받아서 로그아웃 처리합니다.
- 서버는 액세스 토큰, 리프레시 토큰을 받으면 블랙 리스트에 추가하여야 합니다.

### 액세스 토큰 갱신
- 사용자는 인가가 요구되는 API 요청시 쿠키에 액세스 토큰 및 리프레시 토큰을 담아서 전송한다. 만약 액세스 토큰이 만료되고, 리프레시 토큰이 만료되지 않았다면 액세스 토큰을 갱신한다. 갱신한후 서버는 쿠키에 액세스 토큰, 리프레시 토큰을 담아서 응답한다
- 리프레시 토큰의 만료시간이 1시간 미만인 경우 리프레시 토큰 또한 갱신하여야 한다
- 사용자가 API 요청시 액세스 토큰, 리프레시 토큰 둘다 만료되었다면 401 응답합니다.
- 해당 서비스는 별도의 액세스 토큰 갱신 API를 명시하여 처리하는 것이 아닌 다른 인가가 요구되는 API 수행중에 처리하여야 합니다.

## 알림

### 회원 알림 목록 조회
- 사용자는 웹 애플리케이션을 실행하면서 그동안 온 알림들을 조회합니다.
- **알림 조회시 읽지 않은 알림들과 읽었지만 삭제하지 않은 알림들을 조회**합니다.
- 정렬 기준 : 최근에 온 알림 메시지가 제일 앞에 위치해야 함

### 회원 알림 모두 읽음
- 사용자는 알림 메시지들을 모두 읽을 수 있습니다.
- 클라이언트는 알람 모두 읽음 처리를 위해서 서버로 알림의 등록번호 리스트를 전달하며 읽음 처리를 요청합니다.
- 서버는 알림 등록번호 리스트를 받아서 해당하는 알림들을 읽음 처리합니다.

### 회원 특정 알림 읽음
- 사용자는 특정한 알림을 읽을 수 있습니다.
- 클라이언트는 알림 읽음 처리를 위해서 서버로 알림의 등록번호를 전달하며 읽음 처리를 요청합니다.
- 서버는 알림 등록번호를 받아서 해당하는 알림을 읽음 처리합니다.

### 회원 알림 단일 삭제
- 사용자는 특정한 알림을 선택하고 지우기를 할 수 있습니다.

### 회원 알림 전체 삭제
- 사용자는 알림 메시지들을 모두 지울 수 있습니다.

### 회원 알림 설정 수정
사용자는 클라이언트 애플리케이션의 데스크탑 설정 및 사용자 알림 설정을 수정할 수 있습니다.
- 브라우저로부터 데스크탑 알림 받기는 사용자가 애플리케이션으로부터 브라우저 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : false
- 포트폴리오 목표 수익률 도달 알림 설정은 사용자가 애플리케이션으로부터 각각의 포트폴리오에 설정된 목표 수익률 도달 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : true
	- 해당 옵션이 false이면 각 포트폴리오의 목표 수익률 도달 알림이 true여도 알림을 받지 않습니다. 즉, 전체 포트폴리오의 목표 수익률 도달 알림을 받지 않겠다는 것을 의미합니다.
- 포트폴리오 최대 손실율 도달 알림 설정은 사용자가 애플리케이션으로부터 각각의 포트폴리오에 설정된 최대 손실율 도달 알림을 받을 것인지 설정하는 옵션입니다.
	- 기본값 : true
	- 해당 옵션도 false이면 목표 수익율 도달 알림 설정과 동일합니다.
- 종목 지정가 알림 설정은 사용자가 애플리케이션으로부터 특정한 종목이 특정한 가격에 도달했음을 알려주는 설정입니다.
	- 기본값 : true
	- 해당 옵션이 false이면 특정한 종목 지정가 알림이 활성화되어 있어도 전부 알림을 받지 않습니다.
- 해당 알림 설정이 false로 변경되어도 각 포트폴리오 및 지정가에 설정된 상세 알림 설정은 변경되지 않는다. 예를 들어 포트폴리오의 목표 수익률 도달 알림 설정이 false로 변경되어도 각 특정한 포트폴리오에 설정된 목표 수익율 도달 알림은 false로 변경되지 않는다.
![[Pasted image 20240131153924.png]]
- 알림 설정에서 4가지 설정(브라우저, 포트폴리오 목표 수익률, 최대 손실율, 종목 지정가 알림)이 전부 비활성화로 변경한 다음에 저장을 한다면 서버의 FCM 토큰은 제거되어야 합니다.
	- 별도의 fcmTokenId가 전송됩니다.