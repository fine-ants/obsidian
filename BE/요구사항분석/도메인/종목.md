- [[#종목|종목]]
	- [[#종목#종목 검색|종목 검색]]
	- [[#종목#종목 상세 정보|종목 상세 정보]]
	- [[#종목#종목 최신화|종목 최신화]]

## 종목
### 종목 검색
- 사용자는 종목을 검색할 수 있어야 합니다.
- 사용자는 키워드를 입력하여 해당 키워드를 포함하고 있는 종목을 검색합니다.
- 서버는 키워드를 전달받으면 종목의 이름, 티커심볼, 외국이름중에서 키워드가 포함된 종목들을 조회해야 합니다.
- 종목 검색은 로그인하지 않은 사용자도 가능해야 합니다.
- 서버는 무한 스크롤 방식으로 일부의 종목 데이터를 응답해야 합니다.
- 응답 정보
	- 종목 코드(stockCode)
	- 티커심볼(tickerSymbol)
	- 이름(companyName)
	- 영문명(companyNameEng)
	- 시장종류(market)

### 종목 상세 정보
- 사용자는 특정 종목의 상세 정보를 조회할 수 있습니다.
- 응답 정보
	- 종목코드(stockCode)
	- 티커심볼(tickerSymbol)
	- 이름(companyName)
	- 영문명(companyNameEng)
	- 시장종류(market)
	- 현재가(currentPrice)
	- 일일변동금액(dailyChange)
	- 일일변동율(dailyChangeRate)
	- 업종(sector)
	- 연배당금(annualDividend)
	- 연배당율(annualDividendYield)
	- 배당월 목록(dividendMonths)
- 서버는 종목의 작년 배당금 정보와 현재 조회되는 배당금 정보를 이용하여 올해 배당월 목록을 계산하여 응답해야 한다

### 종목 최신화
- 서버는 하루에 한번 평일 오전 8시에 종목들을 최신화하는 작업을 수행해야 합니다.
	- 새로 추가된 종목들을 데이터베이스에 추가합니다.
	- 상장 폐지된 종목들을 데이터베이스에서 제거합니다.
		- 사용자의 포트폴리오에 등록된 상장 폐지된 종목들은 삭제되어야 합니다.
			- 포트폴리오 종목
			- 매입 이력
			- 종목 배당금
- 종목 최신화 도중 종목의 상장정보(IPO) 조회일자는 어제일자~당일일자입니다.
	- ex) 시스템이 2024년 7월 23일 08시에 종목 최신화 스케줄링을 수행하는 경우 어제일자는 2024년 7월 22일, 당일일자는 2024년 7월 23일입니다.

## 종목 현재가 저장
- 종목 현재가를 캐시 저장소에 저장할때 현재가 및 신선도를  함께 저장해야 한다.
- 종목 현재가 데이터는 json 형태로 저장되어야 한다.
- 저장 구조
	- 티커 심볼
	- 현재가
	- 신선도
		- 신선도는 데이터의 마지막 업데이트 시간(lastUpdateAt)
		- 예를 들어 신선도가 5초 초과되었다면 신선도가 떨어진다고 할 수 있다.
- 클라이언트에서 신선도 값이 특정 수치 기준을 초과했다면 신선하지 않는 데이터로 간주하여 새로운 현재가를 조회하여 저장하도록 해야 합니다.
- 종목 현재가 컬렉션 : Hash


## 종목 현재가 조회
- 캐시 저장소에 저장되어 있는 종목의 현재가를 조회해야 한다.
- 데이터가 캐시 저장소에 없다면 외부 API를 이용하여 조회 후 저장해야 한다.
	- 동기적인 이벤트 방식으로 외부 API를 요청해야 한다.
- 데이터가 캐시 저장소에 있지만 신선도가 떨어지면 기존 데이터는 반환하고 비동기 방식으로 현재가 조회 및 저장하는 이벤트를 발행해야 한다.
- 데이터가 캐시 저장소에 존재하고 신선도 기준도 만족하면 데이터를 종목의 현재가를 반환해야 한다.
- 종목 현재가 장시간 내에서 조회시 신선도 개념을 적용하여 처리해야 한다.
	- 캐시 저장소에 데이터 없음 : 동기 이벤트를 발행하고 저장 후 데이터 반환
	- 캐시 저장소에 데이터 존재하고, 신선도 높음 : 기존 데이터 반환
	- 캐시 저장소에 데이터 존재하고, 신선도 낮음 : 비동기 이벤트를 발행하고 기존 데이터 반환
- 종목 현재가 장시간 외(16:00 ~ 익일 09:00)에서 조회시 다음과 같이 처리해야 한다.
	- 캐시 저장소에 데이터 없음 : 동기 이벤트를 발행하고 저장 후 데이터 반환
	- 캐시 저장소에 데이터 존재하고, 신선도 높음 : 기존 데이터 반환
	- 캐시 저장소에 데이터 존재하고, 신선도 낮음 : 기존 데이터 반환
		- 이 경우에 비동기 이벤트를 발행하지 않음



