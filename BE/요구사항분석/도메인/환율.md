- [[#환율|환율]]
	- [[#환율#환율 추가|환율 추가]]
	- [[#환율#환율 조회|환율 조회]]
	- [[#환율#환율 업데이트|환율 업데이트]]
	- [[#환율#환율 삭제|환율 삭제]]
	- [[#환율#환율 기준 설정|환율 기준 설정]]
	- [[#환율#트러블슈팅: 환율 업데이트 서비스|트러블슈팅: 환율 업데이트 서비스]]


## 환율
### 환율 추가
- 관리자는 통화를 추가할 수 있습니다.
- 관리자는 존재하지 않은 통화를 추가할 수 없습니다.
- 관리자는 이미 추가된 통화를 추가할 수 없습니다.

### 환율 조회
- 관리자는 통화들의 환율들을 조회할 수 있습니다.

### 환율 업데이트
- 서버는 하루에 한번 open api 서버를 통해서 환율을 업데이트한다
- 데이터베이스에 저장되는 환율의 기준은 원화(KRW, rate=1)이어야 한다
- 환율 업데이트 하는 경우 외부 API로부터 에러가 발생하는 경우 가장 최근의 환율로 업데이트합니다.
	- 예를 들어 외부 API로부터 요청 할당량 고갈이 발생하는 경우 가장 최근에 저장한 환율로 업데이트합니다.
- 환율 테이블 currency 구성
	- code(ex, USD, KRW)
	- rate (ex, 0.0001, 1)

### 환율 삭제
- 관리자는 환율들을 삭제할 수 있습니다.
- 기준 통화를 삭제하는 경우 에러를 발생시켜야 합니다.
	- 기준 통화를 삭제하기전에 다른 통화를 기준 통화로 설정하여야 합니다.
- 관리자는 기준 통화를 제외한 모든 통화를 삭제할 수 있습니다.

### 환율 기준 설정
- 관리자는 통화중에서 기준을 설정할 통화를 설정합니다.
- 기준으로 설정된 통화(ex, KRW)는 rate가 1로 설정됩니다.
- 기준 통화 설정시 환율이 기준 통화를 기준으로 갱신되어야 합니다.

### 트러블슈팅: 환율 업데이트 서비스
배경
- 서버를 실행하거나 한 시간에 한번씩 기준 환율을 기준으로 환율을 업데이트합니다.
문제
- 기존 구현 방식은 로컬 서버에서 실행시 Rapid API를 이용하여 환율 정보를 가져옵니다. 그러나 Rapid API의 요청 할당량이 고갈되면 타임아웃 예외가 발생하여 실패합니다.
- 만약 로컬 서버 실행시 환율 업데이트에 실패하면 기준 환율을 제외한 다음 환율들은 0으로 초기화됩니다.
- 로컬 서버 실행시에 Rapid API의 요청 할당량을 소모하고 있다.
제안되는 해결 방법
- 기본값 사용하는 방법
	- 서버에 아무런 환율 정보가 없고 외부 API 요청도 실패한 경우 미리 정해둔 기본값을 설정합니다.
	- 장점
		- 서비스가 정상 동작 가능(예: 가격 계산, 환율 표시)
	- 단점
		- 실제 환율과 차이가 있을 수 있습니다. 이는 사용자에게 별도 고지가 필요합니다.
- 서비스 일시 중지 또는 제한적 기능 제공
	- 환율 데이터가 없는 상황에서는 일부 기능(예: 해외 결제, 통화 변환 등)을 제한
	- 장점
		- 잘못된 환율로 잘못된 금액이 처리되는 것을 방지함
	- 단점
		- 사용자 경험 저하 가능
- Retry + 백오프 전략 + 알림 시스템 연동
	- 일정 시간 간격으로 재시도하며, 일정 횟수 실패시 슬랙/메일 등으로 알림
	- 장점
		- 자동 복구 가능성 확보
	- 단점
		- 최초 요청 시까지 대기 필요
- 시스템 운영자가 수동 개입 가능한 구조를 설계
	- 관리자가 기본 환율을 수동 입력 가능하도록 Admin 페이지나 설정 파일 제공
	- 장점
		- 비상시 유연한 대응 가능
	- 단점
		- 자동화가 아니기 때문에 관리 비용이 존재함
해결방법
- 로컬 서버 실행시에는 고정된 환율을 가진 파일을 사용하고 로컬 실행환경에서는 스케줄러를 사용하지 않음.
- 환율 업데이트 서비스 수행시 외부 API로부터 오류 응답이 오면 Retry + 백오프 전략 + 알림 시스템 연동(메일을 사용함)
	- 재시도 전략에도 불구하고 실패하게 되면 별도 변경이 없이 기존 저장된 환율을 사용합니다.
- 관리자가 환율을 수정할 수 있도록 API 제공