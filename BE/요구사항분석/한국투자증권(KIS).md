- [[#한국투자증권|한국투자증권]]
	- [[#한국투자증권#종목 현재가 전체 갱신|종목 현재가 전체 갱신]]
	- [[#한국투자증권#종목 현재가 일부 갱신|종목 현재가 일부 갱신]]
	- [[#한국투자증권#종목 현재가 조회|종목 현재가 조회]]
	- [[#한국투자증권#종목 종가 전체 갱신|종목 종가 전체 갱신]]
	- [[#한국투자증권#종목 종가 일부 갱신|종목 종가 일부 갱신]]


## 한국투자증권
### 종목 현재가 전체 갱신
- 관리자는 서버에서 관리하고 있는 종목의 현재가를 다시 갱신합니다.
- 응답정보
	- 티커심볼(tickerSymbol)
	- 현재가(price)

### 종목 현재가 일부 갱신
- 관리자는 일부 종목들의 현재가를 갱신합니다.
- 입력 정보
	- 티커심볼 리스트(tickerSymbols)
- 응답 정보
	- 티커심볼(tickerSymbol)
	- 현재가(price)

### 종목 현재가 조회
- 관리자는 한국투자증권 외부 서버를 통하여 종목의 현재가를 조회합니다.
- 응답 정보
	- 티커심볼(tickerSymbol)
	- 현재가(price)

### 종목 종가 전체 갱신
- 관리자는 한국투자증권 외부 서버를 통하여 서버에서 관리하고 있는 전체 종목들의 종가를 다시 갱신합니다.
- 응답정보
	- 티커심볼(tickerSymbol)
	- 종가(closingPrice)

### 종목 종가 일부 갱신
- 관리자는 한국투자증권 외부 서버를 통하여 일부 종목들의 종가를 갱신합니다.
- 입력 정보
	- 티커심볼 리스트(tickerSymbols)
- 응답 정보
	- 티커심볼(tickerSymbol)
	- 종가(closingPrice)

### 종목 상장 정보 조회
- 한국투자증권 외부 서버를 통하여 종목의 상장 정보를 조회합니다.


### 사용자에게 종목의 현재가를 빠르게 전달하기 위한 설계
#### 문제점
현재 서버에서 종목의 현재가를 갱신하는 방법은 장 시간(9~16)동안에 포트폴리오들에 저장된 종목들을 대상으로 각각 한국투자증권에 질의한 다음에 질의한 현재가를 레디스 저장소에 저장하는 방식입니다. 실행 과정을 정리하면 다음과 같습니다.
1. 장시간에 모든 포트폴리오 및 종목 지정가를 조회합니다.
2. 포트폴리오에 저장된 모든 종목들을 조회합니다.
3. 고유한 모든 종목들의 티커심볼을 이용하여 한국투자증권에 질의합니다.
4. 질의한 결과에서 현재가를 레디스 저장소에 저장합니다.

위와 같은 시스템에서 문제점은 포트폴리오에 등록된 종목만을 대상으로 각각의 종목들에 대해서 현재가 조회를 질의한다는 점입니다. 사용자는 요청하지도 않았지만 계속 현재가를 조회한 다음에 레디스에 저장해두고 있습니다. 또한 각각의 종목에 대해서 한국투자증권에 REST API 요청을 하기 때문에 많은 요청을 하는 점도 있습니다. 문제점을 정리하면 다음과 같습니다.
- 사용자가 실제 요청하지도 않는 종목에 대해서 현재가 갱신
- 한국투자증권에 많은 REST API 요청을 하고 있음

#### 개선방향
사용자가 특정한 포트폴리오를 조회할때 서버에서는 SSE 방식으로 데이터를 응답하게 됩니다. 따라서 특정한 포트폴리오 조회시 포트폴리오에 등록된 종목들을 가지고 종목들만을 관리하는 모듈에 넣습니다. 관리하는 모듈은 현재가 관리하고 있는 종목들을 이용하여 한국투자증권의 실시간 종목 체결가 API와 웹소켓 연결을 하여 실시간 체결가에 따른 현재가를 받습니다. 현재가를 받으면 레디스 저장소에 넣습니다. 그리고 사용자가 SSE 조회를 마치면 관리하는 모듈에서 종목을 제거하여 웹소켓 연결을 끊습니다. 


